<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Installation - Solr OCR Highlighting Plugin</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Installation";
        var mkdocs_page_input_path = "installation.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Solr OCR Highlighting Plugin
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Installation</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../indexing/">Indexing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../alternatives/">Indexing Alternative Terms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../query/">Querying</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../example/">Example Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../performance/">Performance Tuning</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../formats/">Supported Formats</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../changes/">Change Log</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Solr OCR Highlighting Plugin</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>Installation</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/dbmdz/solr-ocrhighlighting/edit/master/docs/installation.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="requirements">Requirements</h2>
<ul>
<li>Some familiarity with configuring Solr</li>
<li>Solr &gt;= 7.5</li>
<li>OCR documents need to be in <a href="../formats/#hocr">hOCR</a>, <a href="../formats/#alto">ALTO</a>
  or <a href="../formats/#miniocr">MiniOCR</a> formats, with at least page-, and word-level
  segmentation</li>
</ul>
<h2 id="obtaining-the-plugin-jar">Obtaining the plugin JAR</h2>
<p>To use the latest release version, refer to the <a href="https://github.com/dbmdz/solr-ocrhighlighting/releases">GitHub Releases list</a>. From there, download the JAR file for the latest version.
To make the plugin available to Solr, create a new directory <code>$SOLR_HOME/contrib/ocrsearch/lib</code> and place the JAR you just downloaded there.</p>
<h1 id="core-configuration">Core Configuration</h1>
<p>To enable the use of the plugin for your Solr core, you will have to edit
both the <code>solrconfig.xml</code> and the <code>schema.xml</code> file in your core&rsquo;s <code>conf</code> directory.</p>
<h2 id="solrconfig">SolrConfig</h2>
<p>In your core&rsquo;s `solrconfig.xml, you need to:</p>
<ol>
<li>Instruct the core to load the OCR highlighting plugin, so it can find the classes
   needed to perform OCR indexing and highlighting.</li>
<li>Define a search component that will perform the OCR highlighting at query time</li>
<li>Add the search component to your request handlers that will trigger the highlighting.</li>
</ol>
<pre><code class="language-xml">&lt;config&gt;
  &lt;!-- ...other configuration options... --&gt;

  &lt;!--
    Tell Solr to load all JAR files from the directory installed the plugin to. 
    This assumes a directory structure where the cores are in `$SOLR_HOME/server/solr/$CORE`
    and the plugin JAR was installed in `$SOLR_HOME/contrib/ocrsearch/lib`. Adjust the
    path if you setup differs.
  --&gt;
  &lt;lib dir=&quot;../../../contrib/ocrsearch/lib&quot; regex=&quot;.*\.jar&quot; /&gt;

  &lt;!-- Add a new named search component that takes care of highlighting OCR field values. --&gt;
  &lt;searchComponent class=&quot;de.digitalcollections.solrocr.solr.OcrHighlightComponent&quot;
                   name=&quot;ocrHighlight&quot; /&gt;

   &lt;!-- ...other search components... --&gt;

  &lt;!--
    Instruct the request handlers you want to enable OCR highlighting for to include the
    search component you defined above. This example uses the standard /select handler.

    CAUTION: Make sure that the OCR highlight component is listed **before** the standard
    highlighting component, but **after** the query component.
  --&gt;
  &lt;requestHandler name=&quot;/select&quot; class=&quot;solr.SearchHandler&quot;&gt;
      &lt;arr name=&quot;components&quot;&gt;
          &lt;str&gt;query&lt;/str&gt;
          &lt;str&gt;ocrHighlight&lt;/str&gt;
          &lt;str&gt;highlight&lt;/str&gt;
      &lt;/arr&gt;
  &lt;/requestHandler&gt;
&lt;/config&gt;
</code></pre>
<p>If you run into problems, a look into these sections of the Solr user&rsquo;s guide might be helpful:</p>
<ul>
<li><a href="https://lucene.apache.org/solr/guide/8_1/resource-and-plugin-loading.html">Resource and Plugin Loading</a></li>
<li><a href="https://lucene.apache.org/solr/guide/8_1/requesthandlers-and-searchcomponents-in-solrconfig.html">RequestHandlers and SearchComponents in SolrConfig</a></li>
</ul>
<h2 id="schema">Schema</h2>
<p>In the core&rsquo;s <code>schema.xml</code>, you need to:</p>
<ol>
<li>Define a new field type that will hold your indexed OCR text</li>
<li>Define which fields are going to hold the indexed OCR text.</li>
</ol>
<p>The <strong>field type</strong> for OCR text is usually identical to your regular text field, with the
difference that there are one or two extra <em>character filters</em> at the beginning of your
<em>index analysis chain</em>:
  - <code>ExternalUtf8ContentFilterFactory</code> will (optionally) allow you to index and highlight OCR from
    external  sources on the file system. More on this in the <a href="../indexing/">Indexing chapter</a>.
  - <code>OcrCharFilterFactory</code> will retrieve the raw OCR data and extract the plain text that is
    going to pass through the rest of the analysis chain. It will auto-detect the used OCR
    formats, which means that <strong>you can use different OCR formats alongside each other</strong>.
    After this filter, Solr will treat the field just like a regular text field for purposes
    of analysis.</p>
<pre><code class="language-xml">&lt;schema&gt;
  &lt;types&gt;
    &lt;fieldtype name=&quot;text_ocr&quot; class=&quot;solr.TextField&quot; storeOffsetsWithPositions=&quot;true&quot; 
               termVectors=&quot;true&quot;&gt;
      &lt;analyzer type=&quot;index&quot;&gt;
        &lt;!-- For loading external files as field values during indexing --&gt;
        &lt;charFilter class=&quot;de.digitalcollections.solrocr.lucene.filters.ExternalUtf8ContentFilterFactory&quot; /&gt;
        &lt;!-- For converting OCR to plaintext --&gt;
        &lt;charFilter class=&quot;de.digitalcollections.solrocr.lucene.filters.OcrCharFilterFactory&quot; /&gt;
        &lt;!-- ...rest of your index analysis chain... --&gt;
      &lt;/analyzer&gt;
      &lt;analyzer type=&quot;query&quot;&gt;
        &lt;!-- your query analysis chain, should not include the character filters --&gt;
      &lt;/analyzer&gt;
    &lt;/fieldtype&gt;
  &lt;/types&gt;

  &lt;fields&gt;
    &lt;!-- ...your other fields ... --&gt;

    &lt;!-- A field that uses the OCR field type. Has to be `stored`. --&gt;
    &lt;field name=&quot;ocr_text&quot; type=&quot;text_ocr&quot; multiValued=&quot;false&quot; indexed=&quot;true&quot; stored=&quot;true&quot; /&gt;
  &lt;/fields&gt;
&lt;/schema&gt;
</code></pre>
<p>If you struggle with setting up your schema, a look into the <a href="https://lucene.apache.org/solr/guide/8_1/documents-fields-and-schema-design.html">Schema Design</a>
chapter of the Solr user&rsquo;s guide might be helpful.</p>
<div class="admonition caution">
<p class="admonition-title">No support for multi-valued fields</p>
<p>Due to certain limitations in Lucene/Solr, it is currently <strong>not possible
to use multi-valued fields for OCR highlighting</strong>. You can work around
this by leveraging some of the advanced features of <a href="../indexing/">source pointers</a>,
though.</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../indexing/" class="btn btn-neutral float-right" title="Indexing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/dbmdz/solr-ocrhighlighting/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../indexing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
      <script src="../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
